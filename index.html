<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Sapu's Portofolio</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(145deg, #d0e7ff 0%, #a1caff 40%, #70b0ff 100%);
    color: #04223c;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    height: 100vh;
    max-width: 100vw;
    overflow: hidden;
  }
  header {
    padding: 1.2rem 1.5rem;
    background: #8ec9ff;
    box-shadow: 0 4px 10px rgba(62, 144, 221, 0.5);
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 0.08em;
    text-align: center;
    user-select: none;
    color: white;
    text-shadow: 1px 1px 5px rgba(0,0,0,0.15);
  }
  main {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 1.5rem 1rem 2rem;
  }
  .hidden {
    display: none !important;
  }
  /* Login Section */
  #login-section {
    max-width: 340px;
    margin: 1.5rem auto;
    padding: 2.5rem 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(62, 144, 221, 0.2);
    border: 2px solid #5db2ff;
    transition: box-shadow 0.3s ease;
  }
  #login-section:hover {
    box-shadow: 0 12px 24px rgba(62, 144, 221, 0.4);
  }
  #login-section h2 {
    margin-bottom: 1.3rem;
    font-weight: 800;
    font-size: 1.4rem;
    text-align: center;
    color: #0a214a;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }
  #login-section input[type="password"] {
    width: 100%;
    padding: 0.75rem 0.8rem;
    font-size: 1rem;
    border-radius: 4px;
    border: 1px solid #ccc;
    outline-offset: 3px;
    margin-bottom: 1.3rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  #login-section input[type="password"]:focus {
    border-color: #007bff;
    box-shadow: 0 0 8px #007bff88;
  }
  #login-section button {
    width: 100%;
    padding: 0.7rem 0;
    border: none;
    border-radius: 4px;
    background: #007bff;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #login-section button:hover {
    background: #0056b3;
  }
  #login-error {
    color: #c00;
    font-size: 0.9rem;
    text-align: center;
    height: 1.3rem;
  }

  /* Uploader Section */
  #uploader-section {
    max-width: 400px;
    margin: 1rem auto;
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  #uploader-section h2 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.4rem;
    margin-bottom: 1rem;
    text-align: center;
    color: #333;
  }
  #project-title {
    width: 100%;
    padding: 0.6rem 0.8rem;
    font-size: 1rem;
    margin-bottom: 1rem;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  #video-files {
    margin-bottom: 1.5rem;
  }
  #youtube-url {
    width: 100%;
    padding: 0.6rem 0.8rem;
    font-size: 1rem;
    margin-bottom: 1rem;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  #upload-btn {
    width: 100%;
    background: #28a745;
    color: #fff;
    border: none;
    font-weight: 600;
    padding: 0.7rem 0;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #upload-btn:hover:not(:disabled) {
    background: #1e7e34;
  }
  #upload-btn:disabled {
    background: #94d3a2;
    cursor: not-allowed;
  }
  #logout-btn {
    margin-top: 1rem;
    width: 100%;
    background: #dc3545;
    color: white;
    font-weight: 600;
    padding: 0.6rem 0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #logout-btn:hover {
    background: #a71d2a;
  }
  #upload-msg {
    text-align: center;
    color: #155724;
    background-color: #d4edda;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  /* Projects Section */
  #projects-section {
    max-width: 1000px;
    margin: auto;
    padding-bottom: 1rem;
  }
  #projects-section h2 {
    font-weight: 700;
    font-size: 1.7rem;
    margin-bottom: 1rem;
    text-align: center;
    color: #222;
  }
  #projects-list {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 1.2rem;
  }
  .project-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .project-title {
    font-weight: 600;
    font-size: 1.1rem;
    margin: 0.5rem 0 0.8rem;
    color: #444;
    text-align: center;
  }
  .project-date {
    font-size: 0.9rem;
    color: #888;
    text-align: center;
    margin-bottom: 0.5rem;
    font-style: italic;
  }
  video, iframe {
    border-radius: 6px;
    width: 100%;
    height: auto;
    max-height: 200px;
    background: #000;
    outline: none;
  }
  .delete-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #ff4c4c;
    border: none;
    border-radius: 50%;
    color: white;
    width: 28px;
    height: 28px;
    font-weight: 700;
    font-size: 1.3rem;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(255, 76, 76, 0.8);
    transition: background-color 0.2s ease;
    line-height: 24px;
    user-select: none;
  }
  .delete-btn:hover {
    background: #b32b2b;
  }

  /* Uploader toggle button (bottom right corner) */
  #uploader-toggle-btn {
    position: fixed;
    bottom: 16px;
    right: 16px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 30px;
    padding: 0.5rem 1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    z-index: 1000;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #uploader-toggle-btn:hover {
    background: #0056b3;
  }

  /* Responsive and mobile friendly */
  @media (max-width: 600px) {
    body {
      font-size: 14px;
    }
    #projects-list {
      grid-template-columns: 1fr;
    }
    video, iframe {
      max-height: 180px;
    }
    #uploader-section, #login-section {
      width: 90%;
      padding: 1rem;
      margin: 1rem auto;
    }
  }
</style>
</head>
<body>
<header>Sapu Portfolio</header>
<main>
  <!-- Login Section -->
  <section id="login-section" class="hidden" aria-label="Uploader Login Section" role="region">
    <h2>Uploader Login</h2>
    <input id="password-input" type="password" placeholder="Enter upload password" aria-label="Upload password"/>
    <button id="login-btn" type="button">Login</button>
    <div id="login-error" aria-live="assertive"></div>
  </section>

  <!-- Uploader Section -->
  <section id="uploader-section" class="hidden" aria-label="Project Video Uploader" role="region">
    <h2>Upload New Projects</h2>
    <input id="project-title" type="text" placeholder="Project title (required)" aria-label="Project title"/>
    <input id="video-files" type="file" accept="video/*" aria-label="Select video files" multiple />
    <input id="youtube-url" type="url" placeholder="YouTube Video URL (optional)" aria-label="YouTube video URL"/>
    <button id="upload-btn" type="button" disabled>Upload Project(s)</button>
    <div id="upload-msg" role="alert" aria-live="polite" class="hidden"></div>
    <button id="logout-btn" type="button">Logout</button>
  </section>

  <!-- Projects List Section -->
  <section id="projects-section" aria-label="Uploaded Projects" role="region">
    <h2>My Projects</h2>
    <div id="projects-list" aria-live="polite" aria-relevant="additions"></div>
  </section>
</main>

<button id="uploader-toggle-btn" aria-label="Open uploader login">Uploader</button>

<script>
  (function() {
    const PASSWORD = "12345aedf."; // Password for uploading
    const loginSection = document.getElementById("login-section");
    const uploaderSection = document.getElementById("uploader-section");
    const projectsList = document.getElementById("projects-list");
    const loginBtn = document.getElementById("login-btn");
    const passwordInput = document.getElementById("password-input");
    const projectTitleInput = document.getElementById("project-title");
    const videoFilesInput = document.getElementById("video-files");
    const youtubeUrlInput = document.getElementById("youtube-url");
    const uploadBtn = document.getElementById("upload-btn");
    const loginError = document.getElementById("login-error");
    const uploadMsg = document.getElementById("upload-msg");
    const logoutBtn = document.getElementById("logout-btn");
    const uploaderToggleBtn = document.getElementById("uploader-toggle-btn");

    // Storage key for projects
    const STORAGE_KEY = "portfolio_projects";

    // State
    let loggedIn = false;
    let uploaderInterfaceVisible = false;

    function saveProjects(projects) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(projects));
    }
    function loadProjects() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return [];
      try {
        return JSON.parse(data);
      } catch {
        return [];
      }
    }

    // Parse YouTube ID helper
    function parseYouTubeId(url) {
      try {
        const regExp = /^.*(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[1].length === 11) ? match[1] : null;
      } catch {
        return null;
      }
    }

    function renderProjects() {
      projectsList.innerHTML = '';
      const projects = loadProjects();
      if (projects.length === 0) {
        projectsList.innerHTML = '<p style="text-align:center;color:#888;">No projects uploaded yet.</p>';
        return;
      }
      projects.forEach((p, index) => {
        const card = document.createElement("div");
        card.className = "project-card";

        const title = document.createElement("h3");
        title.className = "project-title";
        title.textContent = p.title;

        const date = document.createElement("p");
        date.className = "project-date";
        date.textContent = `Uploaded on: ${p.date}`;

        // Delete button only visible if logged in
        if (loggedIn) {
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "delete-btn";
          deleteBtn.title = "Delete Project";
          deleteBtn.setAttribute("aria-label", `Delete project ${p.title}`);
          deleteBtn.innerHTML = "&times;";
          deleteBtn.addEventListener("click", () => {
            if (confirm(`Are you sure you want to delete project "${p.title}"?`)) {
              deleteProject(index);
            }
          });
          card.appendChild(deleteBtn);
        }

        card.appendChild(title);
        card.appendChild(date);

        if (p.videoData.startsWith("http")) {
          // YouTube video
          const videoId = parseYouTubeId(p.videoData);
          if (videoId) {
            const iframe = document.createElement("iframe");
            iframe.setAttribute("src", `https://www.youtube.com/embed/${videoId}`);
            iframe.setAttribute("allowfullscreen", "");
            iframe.setAttribute("aria-label", `YouTube video of project: ${p.title}`);
            iframe.setAttribute("frameborder", "0");
            card.appendChild(iframe);
          } else {
            // Fallback link if not valid YouTube url
            const link = document.createElement("a");
            link.href = p.videoData;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
            link.textContent = "View video";
            link.style.textAlign = "center";
            link.style.marginTop = "10px";
            card.appendChild(link);
          }
        } else {
          // Local video
          const video = document.createElement("video");
          video.setAttribute("controls", "");
          video.setAttribute("preload", "metadata");
          video.src = p.videoData;
          video.setAttribute("aria-label", `Video of project: ${p.title}`);
          card.appendChild(video);
        }
        projectsList.appendChild(card);
      });
    }

    function deleteProject(index) {
      const projects = loadProjects();
      projects.splice(index, 1);
      saveProjects(projects);
      renderProjects();
    }

    function updateUI() {
      if (!uploaderInterfaceVisible) {
        loginSection.classList.add("hidden");
        uploaderSection.classList.add("hidden");
        uploaderToggleBtn.textContent = "Uploader";
      } else {
        uploaderToggleBtn.textContent = "Close";
        if (loggedIn) {
          loginSection.classList.add("hidden");
          uploaderSection.classList.remove("hidden");
          passwordInput.value = "";
          loginError.textContent = "";
        } else {
          loginSection.classList.remove("hidden");
          uploaderSection.classList.add("hidden");
        }
      }
      // Also re-render to refresh delete buttons visibility
      renderProjects();
    }

    function checkUploadFormValidity() {
      if (
        projectTitleInput.value.trim() &&
        (videoFilesInput.files.length > 0 || youtubeUrlInput.value.trim() !== "")
      ) {
        uploadBtn.disabled = false;
      } else {
        uploadBtn.disabled = true;
      }
    }

    loginBtn.addEventListener("click", () => {
      const entered = passwordInput.value;
      if (entered === PASSWORD) {
        loggedIn = true;
        loginError.textContent = "";
        passwordInput.value = "";
        updateUI();
      } else {
        loginError.textContent = "Incorrect password.";
      }
    });

    passwordInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        loginBtn.click();
      }
    });

    logoutBtn.addEventListener("click", () => {
      loggedIn = false;
      uploadMsg.classList.add("hidden");
      projectTitleInput.value = "";
      videoFilesInput.value = "";
      youtubeUrlInput.value = "";
      uploadBtn.disabled = true;
      updateUI();
    });

    projectTitleInput.addEventListener("input", checkUploadFormValidity);
    videoFilesInput.addEventListener("change", () => {
      if (videoFilesInput.files.length > 0) youtubeUrlInput.value = "";
      checkUploadFormValidity();
    });
    youtubeUrlInput.addEventListener("input", () => {
      if (youtubeUrlInput.value.trim() !== "") videoFilesInput.value = "";
      checkUploadFormValidity();
    });

    uploadBtn.addEventListener("click", () => {
      if (!loggedIn) return;
      const title = projectTitleInput.value.trim();
      const files = [...videoFilesInput.files];
      const youtubeUrl = youtubeUrlInput.value.trim();
      const currentDate = new Date().toLocaleDateString();

      if (!title || (files.length === 0 && youtubeUrl === "")) return;

      uploadBtn.disabled = true;
      uploadMsg.textContent = "Uploading...";
      uploadMsg.classList.remove("hidden");

      const projects = loadProjects();

      function finalizeUpload() {
        renderProjects();
        uploadMsg.textContent = "Upload successful!";
        projectTitleInput.value = "";
        videoFilesInput.value = "";
        youtubeUrlInput.value = "";
        uploadBtn.disabled = true;
        setTimeout(() => {
          uploadMsg.classList.add("hidden");
        }, 3000);
      }

      if (files.length > 0) {
        let loadedCount = 0;
        files.forEach((file) => {
          if (file.size > 100 * 1024 * 1024) {
            uploadMsg.textContent = `File "${file.name}" is too large (max 100MB).`;
            uploadMsg.classList.remove("hidden");
            uploadBtn.disabled = false;
            return;
          }
          const reader = new FileReader();
          reader.onload = (e) => {
            const fileTitle = files.length > 1 ? `${title} (${file.name})` : title;
            projects.push({ title: fileTitle, videoData: e.target.result, date: currentDate });
            loadedCount++;
            if (loadedCount === files.length) {
              saveProjects(projects);
              finalizeUpload();
            }
          };
          reader.onerror = () => {
            uploadMsg.textContent = `Error reading file "${file.name}".`;
            uploadMsg.classList.remove("hidden");
            uploadBtn.disabled = false;
          };
          reader.readAsDataURL(file);
        });
      } else if (youtubeUrl) {
        projects.push({ title, videoData: youtubeUrl, date: currentDate });
        saveProjects(projects);
        finalizeUpload();
      }
    });

    uploaderToggleBtn.addEventListener("click", () => {
      uploaderInterfaceVisible = !uploaderInterfaceVisible;
      if (!uploaderInterfaceVisible) {
        loggedIn = false; // log out on close
      }
      uploadMsg.classList.add("hidden");
      loginError.textContent = "";
      projectTitleInput.value = "";
      videoFilesInput.value = "";
      youtubeUrlInput.value = "";
      uploadBtn.disabled = true;
      updateUI();
    });

    // Initial render and setup
    renderProjects();
    updateUI();
  })();
</script>
</body>
</html>
